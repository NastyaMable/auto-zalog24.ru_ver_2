var myMap,myPlacemark;ymaps.ready(init);var geoPoints=[];function init(){getAvgGeo(geoPoints);myMap=new ymaps.Map("map",{center:[geoPoints[0].lat,geoPoints[0].long],behaviors:[,"drag","dblClickZoom","multiTouch"],zoom:11},{maxAnimationZoomDifference:15,minZoom:1});var a=minB=999999,t=maxT=-999999;$.each(geoPoints,function(n,o){o.isContext&&(a=a>=o.lat?o.lat:a,minB=minB>=o.long?o.long:minB,t=t<=o.lat?o.lat:t,maxT=maxT<=o.long?o.long:maxT),myMap.geoObjects.add(new ymaps.Placemark([o.lat,o.long],{hintContent:o.city,balloonContent:o.address},{iconLayout:"default#image",iconImageHref:"images/map-pointer.png",iconImageSize:[31,51],iconImageOffset:[-13,-42]}))}),myMap.setBounds([[a,minB],[t,maxT]],{checkZoomRange:!0})}function getAvgGeo(a){var t=0,n=0;return $.each(a,function(a,o){t+=parseFloat(o.lat),n+=parseFloat(o.long)}),{lat:t/a.length,long:n/a.length}}$(".map-addresses .address-item").each(function(a){geoPoints.push({lat:$(this).data("lat"),long:$(this).data("long"),address:$(this).data("address"),city:$(this).data("city"),isContext:$(this).hasClass("context")})});